@Layout = "v2/docs-page.php"
@Head{
<title>Processing Request Payloads</title>
}
@Body{
<h1>Processing Request Payloads</h1>
<p>
	Because requests can have different request methods not supported by PHP's native body parser (PUT, DELETE, PATCH, etc), you would normally have to process the request body yourself.
</p>
<p>
	Nox has an abstraction to take care of this for you and make accessing JSON or form-data payloads easy.
</p>
<h2>Prerequisite Attribute</h2>
<p>
	To avoid large payloads being processed unnecessarily, Nox payload processing is an opt-in system signified by adding the framework's ProcessRequestBody attribute to an MVC controller.
</p>
<pre class="language-php line-numbers">
	<code>
		&lt;?php

			namespace UserSettings;

			use Nox\Http\Request;
			use Nox\Http\Attributes\ProcessRequestBody;
			use Nox\RenderEngine\Renderer;
			use Nox\Router\Attributes\Controller;
			use Nox\Router\Attributes\Route;
			use Nox\Router\BaseController;

			#[Controller]
			class SearchController extends BaseController
			{

				#[Route("PUT", "/user/settings")]
				public function updateUserSettings(): string
				{
					$payload = Request::getRequestPayload();

					try{
						$userEmailPayload = $payload->getTextPayload("email");
					}catch(NoPayloadFound $e){
						return $e->getMessage();
					}

					$userEmail = $userEmailPayload->contents;

					// Do some logic with $userEmail

					return "Done!";
				}
			}
	</code>
</pre>
<h2>Different Payload Types</h2>
<p>
	Above you can see that you can fetch text payloads via <code>getTextPayload()</code> and that an exception is thrown if <strong>that payload doesn't exist in the request</strong> (this is not the same as the payload existing but being empty - an exception is not thrown in that case).
</p>
<p>
	There are two other types of payloads you could receive - file payloads and array payloads.
</p>
<p>
	Array payloads are only available for content requests of type <code>application/json</code>. Otherwise, the JSON data sent via form data content types or other content types will just be the JSON string itself.
</p>
<p>
	Below are the object property anatomies of the different payload objects you could receive.
</p>
<pre class="language-php line-numbers">
	<code>
		RequestPayload->getTextPayload(string $name): TextPayload
		class TextPayload{
			public string $name;
			public string $contents;
		}
	</code>
</pre>
<pre class="language-php line-numbers">
	<code>
		RequestPayload->getFilePayload(string $name): FileUploadPayload
		class FileUploadPayload{
			public string $name;
			public string $fileName;
			public int $fileSize;
			public string $contentType;
			public string $contents;
		}
	</code>
</pre>
<pre class="language-php line-numbers">
	<code>
		RequestPayload->getArrayPayload(string $name): ArrayPayload
		class ArrayPayload{
			public string $name;
			public array|null $contents;
		}
	</code>
</pre>
<p>
	Each one of these methods to get a payload will throw an exception to type <code>Nox\Http\Exceptions\NoPayloadFound</code> with an error message of which payload wasn't found if the payload doesn't exist in the request body.
</p>
<h2>Nullable Text Payloads</h2>
<p>
	In some instances capturing a ton of exceptions isn't ideal - such as a case where you have many checkboxes on the front-end. A checkbox that isn't checked won't send the payload for that checkbox to the backend upon submission. In this case, you can use the alternative method to <code>getTextPayload</code> to either return the payload or null.
</p>
<pre class="language-php line-numbers">
	<code>
		RequestPayload->getTextPayloadNullable(string $name): TextPayload | null
	</code>
</pre>
}